if(typeof FormoJS=="undefined"){FormoJS={}}FormoJS.Form=new Class({element:null,fields:[],initialize:function(a){this.element=a;a.getElements("p.field").each(function(d){var b=d.get("class").split(" ");var c=null;switch(b[1]){case"text":default:c=new FormoJS.Field(d,this)}this.fields.push(c)},this)}});FormoJS.Field=new Class({elem_block:null,elem_input:null,form:null,request:null,data:null,initialize:function(b,a){this.elem_block=b;this.elem_input=b.getElement("input");this.form=a;this.elem_input.addEvent("change",this.field_blurred.bindWithEvent(this));this.elem_input.addEvent("keypress",this.field_keypress.bindWithEvent(this))},keypress_timer:null,field_blurred:function(a){if(this.keypress_timer!=null){$clear(this.keypress_timer)}this.validate()},field_keypress:function(a){if(this.keypress_timer!=null){$clear(this.keypress_timer)}this.keypress_timer=(function(){this.validate()}).bind(this).delay(1500)},validate:function(){var c=this.elem_block;var a=this;var b="field="+this.elem_input.name+"&value="+this.elem_input.value;if(b==this.data){return}if(this.request!=null){this.request.cancel()}this.data=b;this.request=new Request.JSON({url:FormoJS.validate_url+"field",data:b,onRequest:function(){c.removeClass("valid");c.removeClass("error");c.removeClass("server_error");c.addClass("validating")},onComplete:function(){c.removeClass("validating");a.request=null},onFailure:function(){c.addClass("server_error");a.set_message(this.xhr.responseText)},onSuccess:function(e,d){if(e.status=="valid"){c.addClass("valid")}else{if(e.status=="invalid"){c.addClass("error")}else{c.addClass("server_error")}}a.set_message(e.message)}});this.request.setHeader("Referer",String(document.location));this.request.send()},set_message:function(a){this.elem_block.getElement(".error-message").set("html",a)}});window.addEvent("domready",function(){if(typeof FormoJS.validate_url=="undefined"){if(typeof console!="undefined"){console.log("Validation URL not configured.")}return}$$(".formo_form").each(function(a){new FormoJS.Form(a)})});